---
title: "Условия в Handlebars"
timestamp: 2015-05-11T09:52:01
tags:
  - Handlebars.registerHelper
  - if_eq
  - comparison
  - iff
published: true
books:
  - javascript
  - handlebars
original: handlebars-conditionals
author: szabgab
translator: name2rnd
archive: true
---


Шаблонизатор [Handlebars](http://handlebarsjs.com/) для JavaScript предоставляет условный оператор `if` (так же возможно использование и `else`),
но оператор `if` может обрабатывать только единственное значение (не выражение). Вы можете написать

```
{{#if name}}
..
{{/if}}
```

но не можете написать

```
{{#if name == 'Foo'}}
..
{{/if}}
```

Давайте создадим хелпер (обработчик) для [Handlebars](/handlebars-helpers), который будет предоставлять такую функциональность.


## Условие if

Но перед тем, как создавать хелпер, давайте посмотрим на полноценный пример с использованием оператора `if`.
В объекте есть два значения: cond1 и cond2, true и false соответственно. Остальная часть кода это просто получение шаблона 
и обработка данных в Handlebars.

{% include file="examples/js/handlebars_if.js" %}

Шаблон имеет два фрагмента типа этого, каждый из которых используется для своей переменной.

```
{{#if cond1}}
    true
{{else}}
    false
{{/if}}
```

Полный html код такой:

{% include file="examples/js/handlebars_if.html" %}

[view](examples/js/handlebars_if.html)

Вы можете посмотреть его работу, нажав на ссылку "Try" (откроется в новом окне). Кнопка "show" запускает обработку.

## if_eq

В следующем примере мы реализуем [хелпер Handlebars](/handlebars-helpers) с именем 
`if_eq`. Он ожидает два параметра и будет сравнивать их с помощью `==`.
Хелпер выглядит вот так:

```javascript
Handlebars.registerHelper('if_eq', function(a, b, opts) {
    if (a == b) {
        return opts.fn(this);
    } else {
        return opts.inverse(this);
    }
});
```

Шаблон, использующий наш хелпер, выглядит вот так: (`name` это атрибут, передаваемый в функцию `template`.)

```
{{#if_eq name 'Foo'}}
      true
{{else}}
      false
{{/if_eq}}
```

Файл с JavaScript также содержит объект с данными и код, который у нас был раньше (объединяющий шаблон и данные):

{% include file="examples/js/handlebars_helpers_if_eq.js" %}

Весь HTML, включая шаблон, выглядит так:

{% include file="examples/js/handlebars_helpers_if_eq.html" %}

[view](examples/js/handlebars_helpers_if_eq.html)

Вы можете попробовать пример, нажав на ссылку "Try".

## Uncaught Error: if_eq doesn't match if - 3:7

Мне потребовалось некоторое время, чтобы понять в чем же дело, когда я увидел эту ошибку.
Возможно, что-то заблокировало мой разум, я не уверен. Сможете ли вы определить проблему в этом примере:

{% include file="examples/js/handlebars_helpers_if_eq_typo.html" %}

[view](examples/js/handlebars_helpers_if_eq_typo.html)

Это случилось, когда я начал преобразовывать оператор `if` в условие `if_eq`, но я заменил только открывающий оператор
`{{#if ...}}` на `{{#if_eq ...}}`, но не заменил закрывающий оператор, который остался таким - `{{/if}}/hl>.
Таким образом, ошибка говорит нам, что `if_eq` не соответствует `if`. Возможно, если бы ключевые слова были как-то выделены,
все было бы проще. 

В любом случае, будьте осторожны с такими опечатками. Это просто трата времени. Делайте более интересные ошибки!

## iff - для других условий

Наконец, сделаем более мощный хелпер для проверки условий. Я назвал его `iff`. Я знаю математически смысл этого,
но название выглядит мило и коротко, чтобы быть использованным в нашем случае. Идея такова, чтобы я мог писать условия вот так: 

```
    {{#iff name '==' 'Foo'}}
```

и вот так:

```
    {{#iff answer '>' 40}}
```

В примере я сделал два шаблона. В первом шаблоне есть три таких условия.
Во втором - одно условие `{{#iff 4 '*' 5}}` - чтобы показать, как будет вести себя 
хелпер `iff`, если получит неподдерживаемый оператор. Также я добавил две кнопки - одну для 
обработки первого шаблона, и вторую - для второго шаблона.

{% include file="examples/js/handlebars_conditionals.html" %}

[view](examples/js/handlebars_conditionals.html)

В файле JavaScript лежат данные, код, реагирующий на нажатия и обрабатывающий шаблон, и частичная(!) реализация хелпера `iff`. 
По сути, это огромный оператор `switch`, обрабатывающий отдельно в `case` каждый из допустимых входных операторов.
Поведение по умолчанию (`default`), когда полученный оператор не может быть обработан одним из `case`, 
генерирует исключение.

{% include file="examples/js/handlebars_conditionals.js" %}

## #compare

Добравшись до этого момента, я узнал, что уже есть реализация подобного хелпера, называемая `#compare`.
Этот хелпер можно найти среди [хелперов сравнения](http://assemble.io/helpers/helpers-comparison.html).

В любом случае, я думаю, что было интересно узнать, как такое можно сделать и использовать.
